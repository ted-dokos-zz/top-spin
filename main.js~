// make game
// width, height, how to render, the html_div containing the game.
var game = new Phaser.Game(500, 500, Phaser.AUTO, 'game_div');

var main_state = {

    preload: function(){
        // load the images
        game.load.image('1','assets/1.png');
        game.load.image('2','assets/1.png');
        game.load.image('3','assets/1.png');
        game.load.image('4','assets/1.png');
    },

    create: function(){
        // create the sprites, the ordering, and the positions
        this.current_order = [1,2,3,4,5,6,7,8,9,10,
                              11,12,13,14,15,16,17,18,19,20];
        this.positions = create_positions();
        this.sprite_numbers = [];
        for (var i = 1; i <= 4; i++) {
            this.sprite_numbers.push(game.add.sprite(0,0,i.toString()) );
        }
        position_sprites();

        // keyboard buttons
        var right_key = this.game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);
        var left_key = this.game.input.keyboard.addKey(Phaser.Keyboard.LEFT);
        right_key.onDown.add(move_right,this);
        left_key.onDown.add(move_left,this);
    },
    update: function(){
    }
}

function create_positions() {
    
}


/*
   Calling main_state.sprite_numbers.some(game.tweens.isTweening) doesn't work,
   but then magically if I make a trivial function it does?
   What bullshit.
*/
function is_tweening_fix(x){
    return game.tweens.isTweening(x);
}

function move_right() {
    if (! (main_state.sprite_numbers).some(is_tweening_fix) ) {
        main_state.sprite_numbers.map(
            function(x)
            {game.add.tween(x).to(
                {x:'+30'},100,Phaser.Easing.Quadratic.None,true);});
    }
}

function move_left() {
    if (! main_state.sprite_numbers.some(is_tweening_fix) ) {
        main_state.sprite_numbers.map(
            function(a)
            {game.add.tween(a).to(
                {x:'-30'},100,Phaser.Easing.Quadratic.None,true);});
    }
}

// Add and start the main state
game.state.add('main',main_state);
game.state.start('main');